define(["react","@terminus/nusi","mobx","lodash","@terminus/nusi-engine"],(function(t,e,r,n,a){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=13)}([function(e,r){e.exports=t},function(t,r){t.exports=e},,function(t,e,r){var n=r(11);"string"==typeof n&&(n=[[t.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(8)(n,a);n.locals&&(t.exports=n.locals)},function(t,e){t.exports=r},function(t,e){t.exports=n},function(t,e){t.exports=a},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var a=(o=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),i=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[r].concat(i).concat([a]).join("\n")}var o;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r})).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},a=0;a<this.length;a++){var i=this[a][0];"number"==typeof i&&(n[i]=!0)}for(a=0;a<t.length;a++){var o=t[a];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),e.push(o))}},e}},function(t,e,r){var n,a,i={},o=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=n.apply(this,arguments)),a}),u=function(t,e){return e?e.querySelector(t):document.querySelector(t)},l=function(t){var e={};return function(t,r){if("function"==typeof t)return t();if(void 0===e[t]){var n=u.call(this,t,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,s=0,d=[],f=r(9);function p(t,e){for(var r=0;r<t.length;r++){var n=t[r],a=i[n.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](n.parts[o]);for(;o<n.parts.length;o++)a.parts.push(A(n.parts[o],e))}else{var u=[];for(o=0;o<n.parts.length;o++)u.push(A(n.parts[o],e));i[n.id]={id:n.id,refs:1,parts:u}}}}function b(t,e){for(var r=[],n={},a=0;a<t.length;a++){var i=t[a],o=e.base?i[0]+e.base:i[0],u={css:i[1],media:i[2],sourceMap:i[3]};n[o]?n[o].parts.push(u):r.push(n[o]={id:o,parts:[u]})}return r}function h(t,e){var r=l(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),d.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=l(t.insertAt.before,r);r.insertBefore(e,a)}}function m(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return y(e,t.attrs),h(t,e),e}function y(t,e){Object.keys(e).forEach((function(r){t.setAttribute(r,e[r])}))}function A(t,e){var r,n,a,i;if(e.transform&&t.css){if(!(i="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=i}if(e.singleton){var o=s++;r=c||(c=v(e)),n=O.bind(null,r,o,!1),a=O.bind(null,r,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),h(t,e),e}(e),n=x.bind(null,r,e),a=function(){m(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(e),n=E.bind(null,r),a=function(){m(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else a()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=b(t,e);return p(r,e),function(t){for(var n=[],a=0;a<r.length;a++){var o=r[a];(u=i[o.id]).refs--,n.push(u)}t&&p(b(t,e),e);for(a=0;a<n.length;a++){var u;if(0===(u=n[a]).refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete i[u.id]}}}};var g,_=(g=[],function(t,e){return g[t]=e,g.filter(Boolean).join("\n")});function O(t,e,r,n){var a=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=_(e,a);else{var i=document.createTextNode(a),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(i,o[e]):t.appendChild(i)}}function E(t,e){var r=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function x(t,e,r){var n=r.css,a=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&a;(e.convertToAbsoluteUrls||i)&&(n=f(n)),a&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var o=new Blob([n],{type:"text/css"}),u=t.href;t.href=URL.createObjectURL(o),u&&URL.revokeObjectURL(u)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var a,i=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(a=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},,function(t,e,r){(e=t.exports=r(7)(!1)).push([t.i,"._3teAox-k76xQlDNrvl-6eb ._29iZ16rMF7gaKoWdhl3RWE ._2aNf9iiDsA2LE_KlBM-Opp ._2GTXrR2xS7r1hWLqHKe_tF {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: rgba(0, 0, 0, 0.6);\n  padding: 8px 0;\n  font-size: 14px;\n}\n._1TI-uxnSnp1g6pp5soBvgX ._1DIlSF6RLMYalBmMjVEc_E ._3Uz3ykPd0W5ZsL--MBeyBM ._1DpbriyLw9-ET5Vo8pHbZk {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: rgba(0, 0, 0, 0.6);\n  padding: 8px 0;\n  font-size: 14px;\n}\n._1TI-uxnSnp1g6pp5soBvgX ._1DIlSF6RLMYalBmMjVEc_E ._3Uz3ykPd0W5ZsL--MBeyBM ._1DpbriyLw9-ET5Vo8pHbZk ._2NEvKPm1ovCk2KWC_SHned {\n  cursor: pointer;\n}\n._1TI-uxnSnp1g6pp5soBvgX ._1DIlSF6RLMYalBmMjVEc_E ._3Uz3ykPd0W5ZsL--MBeyBM ._3FnC2MkssUGSsDR1-c-mRc {\n  color: rgba(0, 0, 0, 0.4);\n  margin-top: 6px;\n  display: inline-flex;\n  align-items: center;\n  font-size: 12px;\n  cursor: pointer;\n}\n._1TI-uxnSnp1g6pp5soBvgX ._1DIlSF6RLMYalBmMjVEc_E ._3Uz3ykPd0W5ZsL--MBeyBM ._3FnC2MkssUGSsDR1-c-mRc ._3mBZ3JBfXWFf9WLrngcMyD {\n  margin-left: 6px;\n  color: #34B37E;\n  font-size: 16px;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod .NYTSQI_LsNWkw_5Bkq0yc {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: rgba(0, 0, 0, 0.6);\n  padding: 8px 0;\n  font-size: 14px;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod .NYTSQI_LsNWkw_5Bkq0yc ._1-N12AG-5EKqj_HM01Ojx4 {\n  display: flex;\n  justify-content: space-between;\n  width: 40px;\n  flex: 0 0 auto;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod .NYTSQI_LsNWkw_5Bkq0yc ._1-N12AG-5EKqj_HM01Ojx4 .d5BEtUlijwYPV5VHn5aRN,\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod .NYTSQI_LsNWkw_5Bkq0yc ._1-N12AG-5EKqj_HM01Ojx4 .QShzCZYQ6m-7p8Kg-AIEf {\n  cursor: pointer;\n  font-size: 16px;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod ._3UgrDVztf2ZKYAxzobOHlf {\n  display: flex;\n  justify-content: space-between;\n  margin-top: 12px;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod ._3UgrDVztf2ZKYAxzobOHlf ._1ioCBjE9Dytz_tnCrML3fT {\n  color: rgba(0, 0, 0, 0.6);\n  font-size: 14px;\n}\n._3wO0wmb8CEcp4sACOrKWCT ._2p-d6t8Nj_J09n7awSoqVI .TGL1hprNbBT0KL33BhAod ._1cLo-wQILPu3rCXRSkwmfQ {\n  margin-top: 12px;\n}\n._13HYBWF3GbnfxA_j9D4Lgs {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.06);\n}\n._13HYBWF3GbnfxA_j9D4Lgs ._3SII54SMgkXucYYWJW_Vg8 {\n  color: #333333;\n}\n._13HYBWF3GbnfxA_j9D4Lgs .L2EzSe8Tn28nk-kZTkhCs {\n  cursor: pointer;\n  color: rgba(0, 0, 0, 0.8);\n}\n._1xNRlnQrVxUyS7YWuYYrkm {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  margin-right: -80px;\n}\n._1xNRlnQrVxUyS7YWuYYrkm ._exmcPkyLax-jhUaiK46 {\n  width: calc(33.3333% - 80px);\n  flex: 0 0 auto;\n  margin-right: 80px;\n}\n._3FSP70BVoKdgSAY2bOFlQ2 {\n  position: relative;\n  height: 40px;\n  width: 40px;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  color: rgba(0, 0, 0, 0.4);\n}\n._3FSP70BVoKdgSAY2bOFlQ2 img {\n  max-width: 100%;\n  max-height: 100%;\n}\n._3FSP70BVoKdgSAY2bOFlQ2 .S_ut8c6a9y3pjTrMMGEnD {\n  cursor: pointer;\n  position: absolute;\n  top: 0px;\n  right: -10px;\n  font-size: 14px;\n}\n._3FSP70BVoKdgSAY2bOFlQ2 ._2UauIx6-TOQHagnPcsOqMV {\n  cursor: pointer;\n}\n.a5pf6TLIJ4OnIIi-WdKgz ._3RRca6MJb10LVv1xeJfSM1 {\n  display: flex;\n}\n.a5pf6TLIJ4OnIIi-WdKgz ._2mVuorfcV6hbccio94FKrh {\n  flex: 1;\n}\n.a5pf6TLIJ4OnIIi-WdKgz ._2qvTAGWI50El-2tGal51I9 {\n  margin-right: 5px;\n  line-height: 22px;\n  font-size: 14px;\n}\n",""]),e.locals={"base-attribute-list-wrap":"_3teAox-k76xQlDNrvl-6eb","base-attribute-list":"_29iZ16rMF7gaKoWdhl3RWE","base-attribute-item":"_2aNf9iiDsA2LE_KlBM-Opp","base-attribute-item-header":"_2GTXrR2xS7r1hWLqHKe_tF","default-attribute-list-wrap":"_1TI-uxnSnp1g6pp5soBvgX","default-attribute-list":"_1DIlSF6RLMYalBmMjVEc_E","default-attribute-item":"_3Uz3ykPd0W5ZsL--MBeyBM","default-attribute-item-header":"_1DpbriyLw9-ET5Vo8pHbZk","default-attribute-item-header_del":"_2NEvKPm1ovCk2KWC_SHned","default-attribute-item-sales":"_3FnC2MkssUGSsDR1-c-mRc","default-attribute-item-sales_icon":"_3mBZ3JBfXWFf9WLrngcMyD","sale-attribute-list-wrap":"_3wO0wmb8CEcp4sACOrKWCT","sale-attribute-list":"_2p-d6t8Nj_J09n7awSoqVI","sale-attribute-item":"TGL1hprNbBT0KL33BhAod","sale-attribute-item-header":"NYTSQI_LsNWkw_5Bkq0yc","sale-attribute-item-header_operation":"_1-N12AG-5EKqj_HM01Ojx4","sale-attribute-item-header_add":"d5BEtUlijwYPV5VHn5aRN","sale-attribute-item-header_del":"QShzCZYQ6m-7p8Kg-AIEf","sale-attribute-show_img":"_3UgrDVztf2ZKYAxzobOHlf","sale-attribute-show_img_title":"_1ioCBjE9Dytz_tnCrML3fT","sale-attribute-table":"_1cLo-wQILPu3rCXRSkwmfQ","attribute-header":"_13HYBWF3GbnfxA_j9D4Lgs","attribute-title":"_3SII54SMgkXucYYWJW_Vg8","attribute-add":"L2EzSe8Tn28nk-kZTkhCs","attribute-list":"_1xNRlnQrVxUyS7YWuYYrkm","attribute-item":"_exmcPkyLax-jhUaiK46","sku-image-wrap":"_3FSP70BVoKdgSAY2bOFlQ2","sku-image-delete":"S_ut8c6a9y3pjTrMMGEnD","sku-image-add":"_2UauIx6-TOQHagnPcsOqMV","common-attribute-select":"a5pf6TLIJ4OnIIi-WdKgz","attribute-item-option":"_3RRca6MJb10LVv1xeJfSM1","attribute-item-option-label":"_2mVuorfcV6hbccio94FKrh","attribute-item-option-delete":"_2qvTAGWI50El-2tGal51I9"}},,function(t,e,r){"use strict";r.r(e),r.d(e,"ItemType",(function(){return U})),r.d(e,"AttributeGroup",(function(){return P})),r.d(e,"AttributeValueType",(function(){return Y}));var n,a=r(0),i=r.n(a),o=r(4),u=r(5),l=r.n(u),c=r(6),s=r(1),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderInput=function(){switch(e.props.valueType){case Y.number:return i.a.createElement(s.InputNumber,{placeholder:"请输入属性值"});case Y.date:return i.a.createElement(s.DatePicker,{style:{width:"100%"}});case Y.text:default:return i.a.createElement(s.Input,{placeholder:"请输入属性值"})}},e}return d(e,t),e.prototype.render=function(){var t=this.props,e=t.form,r=t.title,n=e.getFieldDecorator;return i.a.createElement(s.Form,{layout:"vertical"},i.a.createElement(s.Form.Item,{label:r},n("name",{rules:[{required:!0,message:"请输入属性值"}]})(this.renderInput())))},e}(i.a.Component),p=s.Form.create()(f),b=r(3),h=r.n(b),m=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n},v=s.Select.Option,y=function(t){t.skuAttrIds;var e,r=t.categoryAttr,n=t.attribute,o=t.handleChange,u=t.handleAddOtherAttrVal,l=t.handleDeleteOtherAttrVal,c=r||{},d=c.valueType,f=c.values,b=void 0===f?[]:f,y=c.addedValues,A=void 0===y?[]:y,g=c.customizable,_=m(b,A),O=n||{},E=O.attrVal,x=O.id,w=O.attrKey,V=Object(a.useState)(!1),k=V[0],S=V[1];return i.a.createElement("div",null,i.a.createElement(s.Select,{style:{width:"100%"},dropdownClassName:h.a["common-attribute-select"],optionLabelProp:"value",placeholder:"请选择",value:E,disabled:!0,onChange:function(t){return o(t,x)},actionIcon:g?i.a.createElement(s.Icon,{type:"dialog"}):void 0,onActionClick:g?function(){return S(!0)}:void 0},_.map((function(t){return i.a.createElement(v,{value:t},i.a.createElement("div",{className:h.a["attribute-item-option"]},i.a.createElement("span",{className:h.a["attribute-item-option-label"]},t),A.includes(t)?i.a.createElement(s.Icon,{className:h.a["attribute-item-option-delete"],type:"delete",onClick:function(e){e.stopPropagation(),l(t,x)}}):null))}))),k?i.a.createElement(s.Modal,{width:320,title:"新建属性值",visible:k,onOk:function(){e&&e.props.form.validateFields((function(t,e){if(!t){var r=e.name;_.includes(r)?s.Toast.error("已存在此属性"):(u(r,x),S(!1))}}))},onCancel:function(){return S(!1)},closable:!0},i.a.createElement(p,{title:w,valueType:d,wrappedComponentRef:function(t){return e=t}})):null)},A=function(){return(A=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},g=function(t){var e=t.categoryAttributeMap,r=t.otherAttributes,n=t.skuAttrIds,a=t.updateMobxData,o=t.handleAddOtherAttrVal,u=t.handleDeleteOtherAttrVal,l=r.find((function(t){return t.group===P.basic})),c=l&&l.otherAttributes||[];function s(t,e){var n=c.map((function(r){return r.id===e?A(A({},r),{attrVal:t}):r})),i=r.map((function(t){return t.group===P.basic?A(A({},t),{otherAttributes:n}):t}));a("otherAttributes",i)}return i.a.createElement("div",{className:h.a["base-attribute-list-wrap"]},i.a.createElement("div",{className:h.a["attribute-header"]},i.a.createElement("div",{className:h.a["attribute-title"]},"基本属性")),i.a.createElement("div",{className:h.a["base-attribute-list"]+" "+h.a["attribute-list"]},c.map((function(t){var r=t.id,a=t.attrKey;return i.a.createElement("div",{key:r,className:h.a["base-attribute-item"]+" "+h.a["attribute-item"]},i.a.createElement("div",{className:h.a["base-attribute-item-header"]},i.a.createElement("div",{className:h.a["base-attribute-item-header_title"]},a)),i.a.createElement("div",{className:h.a["base-attribute-item-input"]},i.a.createElement(y,{skuAttrIds:n,attribute:t,categoryAttr:e[r],handleChange:s,handleAddOtherAttrVal:o,handleDeleteOtherAttrVal:u})))}))))},_=function(){return(_=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function O(t){var e=t.data,r=t.categoryAttr,n=t.skuAttrIds,a=t.handleInputChange,o=(t.handleDeleteAttribute,t.handleAddOtherAttrVal),u=t.handleDeleteOtherAttrVal,l=((r||{}).salable,e.id),c=e.attrKey;n.includes(l);return i.a.createElement("div",{key:l,className:h.a["default-attribute-item"]+" "+h.a["attribute-item"]},i.a.createElement("div",{className:h.a["default-attribute-item-header"]},i.a.createElement("div",{className:h.a["default-attribute-item-header_title"]},c)),i.a.createElement("div",{className:h.a["default-attribute-item-input"]},i.a.createElement(y,{attribute:e,categoryAttr:r,skuAttrIds:n,handleChange:a,handleAddOtherAttrVal:o,handleDeleteOtherAttrVal:u})))}var E=function(t){var e=t.categoryAttributes,r=t.categoryAttributeMap,n=t.otherAttributes,a=t.skuAttrIds,o=t.updateMobxData,u=t.handleAddOtherAttrVal,l=t.handleDeleteOtherAttrVal,c=n.find((function(t){return t.group===P.normal})),s=c&&c.otherAttributes||[],d=s.map((function(t){return t.id}));e.filter((function(t){var e=t.id;return t.group===P.normal&&!d.includes(e)}));function f(t){b(s.filter((function(e){return e.id!==t})))}function p(t,e){b(s.map((function(r){return r.id===e?_(_({},r),{attrVal:t}):r})))}function b(t){var e=n.map((function(e){return e.group===P.normal?_(_({},e),{otherAttributes:t}):e}));o("otherAttributes",e)}return i.a.createElement("div",{className:h.a["default-attribute-list-wrap"]},i.a.createElement("div",{className:h.a["attribute-header"]},i.a.createElement("div",{className:h.a["attribute-title"]},"普通属性")),i.a.createElement("div",{className:h.a["default-attribute-list"]+" "+h.a["attribute-list"]},s.map((function(t){return i.a.createElement(O,{data:t,skuAttrIds:a,categoryAttr:r[t.id],handleInputChange:p,handleDeleteAttribute:f,handleAddOtherAttrVal:u,handleDeleteOtherAttrVal:l})}))))},x=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x(e,t),e.prototype.render=function(){var t=this.props,e=t.form,r=t.title,n=e.getFieldDecorator;return i.a.createElement(s.Form,{layout:"vertical"},i.a.createElement(s.Form.Item,{label:r},n("name",{rules:[{required:!0,message:"请输入"+r}]})(i.a.createElement(s.Input,{placeholder:"请输入"}))))},e}(i.a.Component),V=s.Form.create()(w),k=function(){return(k=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},S=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n};function j(t){var e=t.data,r=(t.title,t.handleDeleteAttrVal,t.handleAttrValSelect),n=t.isEdit,a=e.id,o=(e.attrKey,e.attributes),u=(void 0===o?[]:o).map((function(t,e){return k(k({},t),{uniqueId:e})})),l=u.filter((function(t){return t.checked})).map((function(t){return t.attrVal}));return i.a.createElement(s.Select,{onChange:function(t){var e=u.filter((function(e){return e.attrVal===t}));r(a,e)},value:l[0],disabled:n},u.map((function(t,e){return i.a.createElement(s.Select.Option,{value:t.attrVal,key:"key"},t.attrVal)})))}var I=function(t){var e,r=t.categoryAttributes,n=t.skuAttributes,o=t.handleSkuAttributeChange,u=t.handleAddSkuAttrVal,l=t.isEdit,c=n.map((function(t){return t.id})),d=(r.filter((function(t){var e=t.salable,r=t.id;return e&&!c.includes(r)})),Object(a.useState)(!1)),f=d[0],p=d[1],b=Object(a.useState)(),m=b[0],v=b[1];function y(){p(!1),v(void 0)}function A(t,e){var r=e.map((function(t){return t.uniqueId})),a=n.map((function(e){var n=e.id,a=e.attributes;if(t===n){var i=a.map((function(t,e){return k(k({},t),{checked:r.includes(e)})}));return k(k({},e),{attributes:i})}return e}));o(a)}return console.log("skuAttributes: ",n),i.a.createElement("div",{className:h.a["sale-attribute-list-wrap"]},i.a.createElement("div",{className:h.a["attribute-header"]},i.a.createElement("div",{className:h.a["attribute-title"]},"销售属性")),i.a.createElement("div",{className:h.a["sale-attribute-list"]+" "+h.a["attribute-list"]},n.map((function(t,e){return i.a.createElement("div",{key:t.id,className:h.a["sale-attribute-item"]+" "+h.a["attribute-item"]},i.a.createElement("div",{className:h.a["sale-attribute-item-header"]},i.a.createElement("div",{className:h.a["sale-attribute-item-header_title"]},t.attrKey)),i.a.createElement("div",{className:h.a["sale-attribute-table"]},i.a.createElement(j,{data:t,title:t.attrKey,handleAttrValSelect:A,isEdit:l})))}))),f?i.a.createElement(s.Modal,{width:320,title:"新建销售属性值",visible:f,onOk:function(){var t=m||{},r=t.id,a=void 0===r?-1:r,i=t.attrKey,o=void 0===i?"":i;e&&e.props.form.validateFields((function(t,e){if(!t){var r=e.name,i={id:a,attrKey:o,attrVal:r,checked:!1,deletable:!0},l=n.map((function(t){return a===t.id?k(k({},t),{attributes:S(t.attributes,[i])}):t}));u(r,a,l),y()}}))},onCancel:y,closable:!0},i.a.createElement(V,{title:m&&m.attrKey||"",wrappedComponentRef:function(t){return e=t}})):null)},N=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return N(e,t),e.prototype.render=function(){var t=this.props.form.getFieldDecorator;return i.a.createElement(s.Form,{layout:"vertical"},i.a.createElement(s.Form.Item,{label:"属性名称"},t("attrKey",{rules:[{required:!0,message:"请输入属性名称"}]})(i.a.createElement(s.Input,{placeholder:"请输入属性名称"}))),i.a.createElement(s.Form.Item,{label:"属性值"},t("attrVal",{rules:[{required:!0,message:"请输入属性值"}]})(i.a.createElement(s.Input,{placeholder:"请输入属性值"}))))},e}(i.a.Component),C=s.Form.create()(L),M=function(){return(M=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},T=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n};function B(t){var e=t.categoryAttr,r=t.data,n=t.handleInputChange,a=(t.handleDeleteAttribute,t.handleAddOtherAttrVal),o=t.handleDeleteOtherAttrVal,u=r.id,l=r.attrKey;return i.a.createElement("div",{key:u,className:h.a["default-attribute-item"]+" "+h.a["attribute-item"]},i.a.createElement("div",{className:h.a["default-attribute-item-header"]},i.a.createElement("div",{className:h.a["default-attribute-item-header_title"]},l)),i.a.createElement("div",{className:h.a["default-attribute-item-input"]},i.a.createElement(y,{attribute:r,categoryAttr:e,skuAttrIds:[],handleChange:n,handleAddOtherAttrVal:a,handleDeleteOtherAttrVal:o})))}var D=function(t){var e,r=t.customAttributes,n=t.otherAttributes,o=t.updateMobxData,u=n.find((function(t){return t.group===P.custom})),l=u&&u.otherAttributes||[],c=Object(a.useState)(!1),d=c[0],f=c[1];function p(t){var e=l.filter((function(e){return e.id!==t})),n=r.filter((function(e){return e.id!==t}));y(e),o("customAttributes",n)}function b(t,e){y(l.map((function(r){return r.id===e?M(M({},r),{attrVal:t}):r})))}function m(t,e){var n=r.map((function(r){var n=r.id,a=r.addedValues;return n===e?M(M({},r),{addedValues:T(a,[t])}):r}));o("customAttributes",n)}function v(t,e){var n=r.map((function(r){var n=r.id,a=r.addedValues;return n===e?M(M({},r),{addedValues:a.filter((function(e){return e!==t}))}):r})),a=l.map((function(r){var n=r.id,a=r.attrVal;return n===e?M(M({},r),{attrVal:a===t?void 0:a}):r}));o("customAttributes",n),y(a)}function y(t){var e=n.map((function(e){return e.group===P.custom?M(M({},e),{otherAttributes:t}):e}));o("otherAttributes",e)}return i.a.createElement("div",{className:h.a["default-attribute-list-wrap"]},i.a.createElement("div",{className:h.a["attribute-header"]},i.a.createElement("div",{className:h.a["attribute-title"]},"自定义属性")),i.a.createElement("div",{className:h.a["default-attribute-list"]+" "+h.a["attribute-list"]},l.map((function(t){var e=r.find((function(e){return e.id===t.id}));return i.a.createElement(B,{categoryAttr:e,data:t,handleInputChange:b,handleDeleteAttribute:p,handleAddOtherAttrVal:m,handleDeleteOtherAttrVal:v})}))),d?i.a.createElement(s.Modal,{width:320,title:"新建自定义属性",visible:d,onOk:function(){e&&e.props.form.validateFields((function(t,e){if(!t){var a=e.attrKey,i=e.attrVal,u=[];if(n.forEach((function(t){var e=t.otherAttributes.map((function(t){return t.attrKey}));u=u.concat(e)})),u.includes(a))return void s.Toast.error("已存在此属性");var c=+new Date,d={id:c,attrKey:a,attrVal:i,group:P.custom},p={id:c,group:P.custom,name:a,salable:!1,customizable:!0,valueType:Y.text,values:[],addedValues:[i]},b=T(r,[p]);console.log("newAttributes: ",b),o("customAttributes",b),y(T(l,[d])),f(!1)}}))},onCancel:function(){return f(!1)},closable:!0},i.a.createElement(C,{wrappedComponentRef:function(t){return e=t}})):null)},K=function(){return(K=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},F=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n};function R(t){return t.map((function(t){return t.id+"_"+t.attrVal})).join("-")}function W(t,e){var r=[];return t.forEach((function(t){var e=t.attributes.filter((function(t){return t.checked}));e.length>0&&r.push(K(K({},t),{attributes:e}))})),function t(e,r){if(void 0===e&&(e=[]),!r||r.length<=0)return e;var n=r[0].attributes,a=r.filter((function(t,e){return e>0})),i=[];return e.length<=0?i=n.map((function(t){return[t]})):n.forEach((function(t){e.forEach((function(e){i.push(F(e,[t]))}))})),t(i,a)}([],r).map((function(t){var r=R(t),n=e.find((function(t){return R((t||{}).attributes||[])===r}));return n||{attributes:t,enable:!0}}))}var U,P,Y,G=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),z=function(){return(z=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},q=function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{l(n.next(t))}catch(t){i(t)}}function u(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}l((n=n.apply(t,e||[])).next())}))},J=function(t,e){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Q=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),a=0;for(e=0;e<r;e++)for(var i=arguments[e],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n};!function(t){t.item="product",t.spu="spu"}(U||(U={})),function(t){t.basic="BASIC",t.normal="DEFAULT",t.custom="USER_DEFINED"}(P||(P={})),function(t){t.text="TEXT",t.number="NUMBER",t.date="DATE"}(Y||(Y={}));var H=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.formatSubmitData=function(){var t=Object(o.toJS)(e.data),r=(t.categoryAttributes,t.otherAttributes),n=t.skuAttributes,a=(t.skuList,(n||[]).map((function(t){return t.id}))),i=((r||[]).map((function(t){var e=t.group,r=t.otherAttributes;if([P.basic,P.normal].includes(e)){var n=(r||[]).filter((function(t){return!a.includes(t.id)}));return z(z({},t),{otherAttributes:n})}if(e===P.custom){n=(r||[]).filter((function(t){return null!=t.attrVal}));return z(z({},t),{otherAttributes:n})}return t})),[]);return n.forEach((function(t){t.attributes.forEach((function(t){if(t.checked){var e={attrKey:t.attrKey,attrVal:t.attrVal,id:t.id};i.push(e)}}))})),{attributes:i}},e.updateMobxData=function(t,r){Object(o.set)(e.data,t,r)},e.handleSkuAttributeChange=function(t){var r=Object(o.toJS)(e.data),n=r.skuList,a=r.otherAttributes,i=W(t,n),u=t.map((function(t){return t.id})),l=a.map((function(t){var e=t.otherAttributes.map((function(t){return u.includes(t.id)?z(z({},t),{attrVal:""}):t}));return z(z({},t),{otherAttributes:e})}));Object(o.set)(e.data,{skuAttributes:t,skuList:i,otherAttributes:l})},e.handleAddSkuAttrVal=function(t,r,n){e.handleAddOtherAttrVal(t,r)},e.handleAddOtherAttrVal=function(t,r){var n=Object(o.toJS)(e.data).categoryAttributes.map((function(e){var n=e.id,a=e.addedValues,i=void 0===a?[]:a;return n===r?z(z({},e),{addedValues:Q(i,[t])}):e}));Object(o.set)(e.data,{categoryAttributes:n,categoryAttributeMap:l.a.keyBy(n,"id")})},e.handleDeleteOtherAttrVal=function(t,r){var n=Object(o.toJS)(e.data),a=n.categoryAttributes,i=n.otherAttributes,u=a.map((function(e){var n=e.id,a=e.addedValues;return n===r?z(z({},e),{addedValues:(a||[]).filter((function(e){return e!==t}))}):e})),c=i.map((function(e){var n=e.otherAttributes.map((function(e){return e.id===r?z(z({},e),{attrVal:e.attrVal===t?void 0:e.attrVal}):e}));return z(z({},e),{otherAttributes:n})}));Object(o.set)(e.data,{categoryAttributes:u,categoryAttributeMap:l.a.keyBy(u,"id"),otherAttributes:c})},e.valid=function(){return q(e,void 0,void 0,(function(){var t;return J(this,(function(e){return!(t=Object(o.toJS)(this.data).skuList)||t.length<=0?(s.Toast.error("基于销售属性创建的SKU不能为空"),[2,!1]):[2,!0]}))}))},e}return G(e,t),e.exportComponent=function(t){return s.Form.create()(t)},Object.defineProperty(e.prototype,"lookupContext",{get:function(){return{data:this.formatSubmitData}},enumerable:!0,configurable:!0}),e.prototype.initOtherAttrGroup=function(t,e){var r=e||{},n=(r.id,r.spu,r.otherAttributes),a=void 0===n?[]:n;r.categoryAttributes;return(a||[]).find((function(e){return e.group===t}))||{group:t,otherAttributes:[]}},e.prototype.fetchDataEnd=function(t,e){var r=t.data,n=r.categoryAttributes,a=void 0===n?[]:n,i=r.id,u=(r.otherAttributes,r.skuAttributes),c=void 0===u?[]:u,s=r.skuList,d=void 0===s?[]:s,f=r.attributes,p=void 0===f?[]:f,b=null!=i,h=[this.initOtherAttrGroup(P.basic,r),this.initOtherAttrGroup(P.normal,r),this.initOtherAttrGroup(P.custom,r)],m=((h.find((function(t){return t.group===P.custom}))||{}).otherAttributes||[]).map((function(t,e){var r=t.id,n=t.attrKey,a=t.attrVal;return{attributeId:r,group:P.custom,name:n,salable:!1,customizable:!0,valueType:Y.text,values:[a],addedValues:[]}})),v=c.map((function(t){var e=t.attributes,r=t.attrKey,n=p.find((function(t){return t.attrKey===r})),a=n?n.attrVal:"",i=e.map((function(t){return z(z({},t),{checked:a===t.attrVal})}));return z(z({},t),{attributes:i})}));console.log("skuAttributes: ",v),Object(o.set)(this.data,{categoryAttributes:a||[],categoryAttributeMap:l.a.keyBy(a,"id"),customAttributes:m,otherAttributes:h,skuAttributes:v||[],skuList:d||[],isEdit:b})},e.prototype.render=function(){var t=Object(o.toJS)(this.data),e=t.categoryAttributeMap,r=t.categoryAttributes,n=void 0===r?[]:r,a=t.otherAttributes,u=void 0===a?[]:a,l=t.customAttributes,c=void 0===l?[]:l,s=t.skuAttributes,d=void 0===s?[]:s,f=t.isEdit,p=d.map((function(t){return t.id}));return i.a.createElement("div",{className:h.a["attribute-wrap"]},i.a.createElement(g,{categoryAttributeMap:e,otherAttributes:u,skuAttrIds:p,updateMobxData:this.updateMobxData,handleAddOtherAttrVal:this.handleAddOtherAttrVal,handleDeleteOtherAttrVal:this.handleDeleteOtherAttrVal}),i.a.createElement(E,{categoryAttributes:n,categoryAttributeMap:e,otherAttributes:u,skuAttrIds:p,updateMobxData:this.updateMobxData,handleAddOtherAttrVal:this.handleAddOtherAttrVal,handleDeleteOtherAttrVal:this.handleDeleteOtherAttrVal}),i.a.createElement(D,{customAttributes:c,otherAttributes:u,updateMobxData:this.updateMobxData}),i.a.createElement(I,{categoryAttributes:n,skuAttributes:d,handleSkuAttributeChange:this.handleSkuAttributeChange,handleAddSkuAttrVal:this.handleAddSkuAttrVal,isEdit:f}))},e}(c.ItemContainer);e.default=H}])}));